# Идея

Фреймворк для написания торговых ботов, которые торгуют по пользовательским стратегиям.

## Существующие решения

### Metatrader MQL5

Предлагает свой язык похожий на C++, довольн мощный инструмент, но довольно большой порог вхождения. Позволяет запускать торговых ботов только на платформах, на которых есть клиент Metatrader.

### Gekko

Платформа для написания торговых Bitcoin ботов. Позволяет описывать стратегии на JS.
Больше не поддерживается.

## Варианты реализации стратегий

Было рассмотрено несколько варинтов для языка реализации стратегий

### yaml 

Довольно прост в освоение и довольно легко парсить, однако удобен лишь для написания декларативного описания сущностей, логику в императивном стиле довольно неудобно писать.

### JB MPS

Есть вариант написать свой язык с поддержкой в IDEA и автоматической генерацией синтаксического анализатора, но у меня нет опыта работы с MPS, поэтому мало что могу сказать об этом варианте с практической удобности и целесообразности.

### Фреймворк для языка программирования

Если написать фреймворк для уже существующего языка, то не придётся заморачиваться с поддержкой языка IDE и пользователю не придётся разбираться в новом языке. Для реализации был выбран Kotlin, так как позволяет описывать торговые стратегии средставами DSL, который может читать не только программист, но и обычный человек.

### Итог

Реализация фреймворк для существующего язык значительно ускорит и упростит как разработку, так и уменьшит порог вхождения.

## Архитектура

### Стэк

- Kotlin
- Java
- InfluxDB

### Описание стратегии

См strategy.md

### Хранение данных

Для хранения исторических данных, которые будут использоваться для подсчёта различных метрик, используется time series база данных InfluxDB. Она предоставляет довольно простой API для работы с данными и легка в настройке, да и как и другая любая time series БД имеет константное время на вставку в не зависимости от количества данных в БД.

### Модули для реализации

- CLI для создания bootstrap проект для бота(Java/Kotlin)
- Модуль для работы с сервисом инвестиций(Java/Kotlin)
- Модуль для подсчёт метрик и работы с данными(Java/Kotlin)
- DSL(Kotlin)
- Core(Kotlin)

**CLI** является фичёй, про которую можно рассказать, но не сделать. Она позволяет не писать кучу раз boilerplate код, каждый раз создавая новый проект, вместо этого мы заполняем параметры(имя проекта, язык build файлов(groovy, kotlin dsl) и т.п) и на выходе получаем готовый gradle проект с нашим фреймворком в зависимостях и базовыми конфигурацями. Ну можно ещё добавить автоматическую упаковку в Docker контейнер(ну а что звучит хайпово) через [jib](https://github.com/GoogleContainerTools/jib/tree/master/jib-gradle-plugin) и заранее написанные Docker файлы.

**Модуль для работы с сервисом инвестиций** необходимо для получения данные по бумаге, которой торгуем, а так же для соверешения операций продажи/покупки.

**Модуль для подсчёт метрик и работы с данными** нужно написать код для получения исторических данных из БД и ряд простых статистических метрик над этими данными(к примеру среднее значение и т.п)

**DSL** написать и спроектировать DSL для элегантоного и удобного описания стратегий

**Core** должен быть написан после проектирования DSL и его имплементации. Должен содержать набор "тупых" методов для работы с остальными компонентами: продажа, покупка, получение исторических данных и т.п. Над которым уже строится DSL. Этот модуль может быть объединён в один с DSL. 

### Что ещё учесть

- Логирование
- Конфигурационные файлы(config4k)

## Особенности при работе с OpenAPI Tinkoff Инвестици

- Есть Sandbox режим, в котором можно тестировать торгового бота
- Есть ограничения в rest api(количество запросов в минуту)
- Можем получить только 120 дней из истории в минуту(без учёта задержек при отправке и получаение ответов)
- Возможно подключиться по WS и получать обновления стакана/свечи(цены за акцию) в реальном времени

## Командная разработка

### Команда

- Катя - Java разработчик
- Эля - Kotlin разработчик
- Илья - Java разработчик
- Костя - Kotlin разработчик, архитектор

### Учёт задач

Для ведения задач был выбран **Trello**, так как позволяет вести таски по workflow: ToDo, In progress, On review, Done. Разработка происходит итеративно спринтами в 1 неделю.

### Система контроля версий

В качестве сервиса системы контроля версий был выбран Github, а в качестве CI/CD сервиса Github Actions.